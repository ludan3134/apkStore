{"level":"debug","time":"2024-10-21T02:24:51.635Z","msg":"logger init ok"}
{"level":"debug","time":"2024-10-21T02:24:51.686Z","msg":"try to connect redis"}
{"level":"info","time":"2024-10-21T02:24:51.686Z","name":"Cache.NewCache","msg":"connect to redis","addr":"47.120.68.50:6059"}
{"level":"info","time":"2024-10-21T02:24:51.835Z","name":"ConnectRedis","msg":"connect redis success"}
{"level":"info","time":"2024-10-21T02:24:51.878Z","name":"Cache.NewCache","msg":"connect to redis success"}
{"level":"debug","time":"2024-10-21T02:24:51.879Z","msg":"connect to redis success"}
{"level":"debug","time":"2024-10-21T02:24:51.879Z","msg":"-----------------service success-------------------------"}
{"level":"debug","time":"2024-10-21T02:24:51.879Z","name":"rpc Serve","msg":"try to serve"}
{"level":"info","time":"2024-10-21T02:24:51.898Z","msg":"Connect","host":"47.120.68.50","port":6008,"database":"rdb","time":198722705,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:51.918Z","msg":"Prepare","name":"SqlCheckAppUniqueByAdd","sql":"\n\t\t\tselect count(id)\n\t\t\tfrom wst.apps\n\t\t\twhere class = $1\n\t\t\t  AND distributor_id = $2\n\t\t\t  AND model_id = $3\n\t\t\t  AND deleted = false\n\t\t\t;\n\t\t","time":20435565,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:51.935Z","msg":"Prepare","sql":"\n\t\t\t\t\t\tDelete \n\t\t\t\t FROM wst.app_version\n  \t\t\t\t WHERE app_id = $1\n\t\t","time":16749420,"alreadyPrepared":false,"pid":2725706,"name":"SqlDeleteAppsVersion"}
{"level":"info","time":"2024-10-21T02:24:51.959Z","msg":"Prepare","name":"SqlCountAppUserList","sql":"\n\t\t\tselect count(id) as total \n\t\t\tfrom wst.app_user f\n\t\t\twhere CASE WHEN $1 = '' THEN TRUE ELSE f.distributor_id =$1::BIGINT END\n\t\t\tAND CASE WHEN $2 = '' THEN TRUE ELSE f.model_id =$2::BIGINT END\n\t\t\tAND CASE WHEN $3 = '' THEN TRUE ELSE f.mac ILIKE '%' ||$3 || '%' END\n\t\t\tAND f.deleted = FALSE\n\t\t","time":23719205,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:51.976Z","msg":"Prepare","name":"SqlGetAppsByCategories","sql":"\n\t\t\tSELECT\n\t\t\t\tf.ID AS apk_id,\n\t\t\t\tf.app_name,\n\t\t\t\tf.app_description,\n\t\t\t\tf.app_icon,\n\t\t\t\tf.app_carousel,\n\t\t\t\tf.app_sort,\n\t\t\t\tf.app_banner,\n\t\t\t\tf.system_requirement,\n\t\t\t\tf.rating,\n\t\t\t\tf.copyright_notice,\n\t\t\t\tC.category_name AS categories_name,\n\t\t\t\tP.plan_name AS price_plans_name,\n\t\t\t\tP.price AS price,\n\t\t\t\tf.deleted,\n\t\t\t\tf.CLASS,\n\t\t\t\tV.version_name AS VERSION,\n\t\t\t\tV.md5,\n\t\t\t\tV.url,\n\t\t\t\tV.filesize,\n\t\t\t\tf.is_show_on_market,\n\t\t\t\tf.is_show_tool_tip,\n\t\t\t\tf.catpromo,\n\t\t\t\tf.category_id\n\t\t\tFROM\n\t\t\t\twst.apps f\n\t\t\t\tJOIN wst.categories C ON c.id = ANY(f.category_ids)\n\t\t\t\tJOIN wst.price_plans P ON p.id = ANY(f.price_plan_ids)\n\t\t\t\tJOIN wst.distributor D ON f.distributor_id = D.ID\n\t\t\t\tJOIN wst.model M ON f.model_id = M.ID\n\t\t\t\tJOIN wst.app_version V ON f.ID = V.app_id\n\t\t\tWHERE\n\t\t\t\tf.deleted = FALSE\n\t\t\t\tAND $1 = ANY(f.category_ids)\n\t\t\t  \tAND c.id =  $1\n\t\t\t\tAND f.distributor_id = $2::bigint\n\t\t\t\tAND f.model_id = $3::bigint\n\t\t\t\tAND V.is_latest = TRUE\n\t\t\t\tAND f.is_show_on_market = 1\n\t\t\tORDER BY\n\t\t\t\t  CAST(app_sort AS INTEGER) ASC;\n\t\t","time":16864600,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:51.988Z","msg":"Prepare","sql":"\n\t\t\tINSERT INTO wst.failure_log (\n\t\t\t\tdistributor_id, \n\t\t\t\tmodel_id, \n\t\t\t\tmac, \n\t\t\t\tdeleted\n\t\t\t) VALUES (\n\t\t\t\t$1,$2, $3,$4\n\t\t\t) ON CONFLICT (mac) DO NOTHING;\n\t\t","time":12211924,"alreadyPrepared":false,"pid":2725706,"name":"SqlInsertFailureRecord"}
{"level":"info","time":"2024-10-21T02:24:52.001Z","msg":"Prepare","pid":2725706,"name":"SqlCheckAppCategories","sql":"\n\t\t\t\tSELECT category_name\n\t\t\t\t FROM wst.categories\n  \t\t\t\t WHERE id = ANY($1)\n\t\t\t\t AND distributor_id = $2\n\t\t\t\t AND model_id = $3\n\t\t","time":12318966,"alreadyPrepared":false}
{"level":"info","time":"2024-10-21T02:24:52.019Z","msg":"Prepare","name":"SqlDeleteApps","sql":"\n\t\t\t\t\t\tDelete \n\t\t\t\t FROM wst.apps\n  \t\t\t\t WHERE id = $1\n\t\t","time":18006511,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.038Z","msg":"Prepare","name":"SqlCountPricePlanList","sql":"\n\t\t\tselect count(id) as total \n\t\t\tfrom wst.price_plans \n\t\t\twhere deleted = false;\n\t\t","time":18886420,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.063Z","msg":"Prepare","alreadyPrepared":false,"pid":2725706,"name":"GetAppsForPushDesktop","sql":"\n\t\t\tSELECT \n\t\t\t\tf.ID AS apk_id,\n\t\t\t\tf.app_name,\n\t\t\t\tf.app_description,\n\t\t\t\tf.app_icon,\n\t\t\t\tf.app_carousel,\n\t\t\t\tf.app_sort,\n\t\t\t\tf.app_banner,\n\t\t\t\tf.system_requirement,\n\t\t\t\tf.rating,\n\t\t\t\tf.copyright_notice,\n\t\t\t\tC.category_name AS categories_name,\n\t\t\t\tP.plan_name AS price_plans_name,\n\t\t\t\tP.price AS price,\n\t\t\t\tf.deleted,\n\t\t\t\tf.CLASS,\n\t\t\t\tV.version_name AS VERSION,\n\t\t\t\tV.md5,\n\t\t\t\tV.url,\n\t\t\t\tV.filesize,\n\t\t\t\tf.is_show_on_market,\n\t\t\t\tf.is_show_tool_tip,\n\t\t\t\tf.catpromo,\n\t\t\t\tf.category_id\n\t\t\tFROM\n\t\t\t\twst.apps f\n\t\t\t\tJOIN wst.categories C ON c.id = ANY(f.category_ids)\n\t\t\t\tJOIN wst.price_plans P ON p.id = ANY(f.price_plan_ids)\n\t\t\t\tJOIN wst.distributor D ON f.distributor_id = D.ID\n\t\t\t\tJOIN wst.model M ON f.model_id = M.ID\n\t\t\t\tJOIN wst.app_version V ON f.ID = V.app_id\n\t\t\tWHERE\n\t\t\t\tf.deleted = FALSE\n\t\t\t\tAND f.distributor_id = $1::bigint\n\t\t\t\tAND f.model_id = $2::bigint\n\t\t\t\tAND V.is_latest = TRUE\n\t\t\t\tAND f.is_show_tool_tip = 1\n\t\t\tORDER BY\n    \t\t\tf.category_id ASC -- 分类 ID 排序\n\t\t","time":24736588}
{"level":"info","time":"2024-10-21T02:24:52.082Z","msg":"Prepare","name":"SqlGetCategoriesByClass","sql":"\n\t\t\tSELECT \n\t\t\t\tcategory_ids \n\t\t\tFROM \n\t\t\t\twst.apps \n\t\t\tWHERE \n\t\t\t\tclass = $1 AND distributor_id =$2 AND model_id = $3;\n\t\t","time":19202890,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.099Z","msg":"Prepare","time":16845343,"alreadyPrepared":false,"pid":2725706,"name":"SqlQueryAppVersionIsLatestByAppId","sql":"\n\t\t\t\t\t\tSelect \n\t\t\t\t\t\t version_name,\n\t\t\t\t\t\t changelog,\n\t\t\t\t\t\t is_latest,\n\t\t\t\t\t\t is_public,\n\t\t\t\t\t\t is_paid,\n\t\t\t\t\t\t filesize,\n\t\t\t\t\t\t md5,\n\t\t\t\t\t\t url,\n\t\t\t\t\t\t force_uninstall,\n\t\t\t\t\t\t class\n\t\t\t\t FROM wst.app_version\n  \t\t\t\t WHERE app_id = $1\n\t\t\t\t AND deleted = false\n\t\t\t     AND is_latest = true;\n\t\t"}
{"level":"info","time":"2024-10-21T02:24:52.112Z","msg":"Prepare","pid":2725706,"name":"SqlInsertPricePlan","sql":"\n\t\t\tinsert into wst.price_plans (\n\t\t\t\tplan_name, \n\t\t\t\tplan_description, \n\t\t\t\tbilling_cycle, \n\t\t\t\ttrial_period, \n\t\t\t\tprice, \n\t\t\t\tdistributor_id, \n\t\t\t\tmodel_id\n\t\t\t) values (\n\t\t\t\t$1,$2, $3,$4, $5,$6, $7\n\t\t\t);\n\t\t","time":12698789,"alreadyPrepared":false}
{"level":"info","time":"2024-10-21T02:24:52.145Z","msg":"Prepare","name":"SqlInsertApps","sql":"\n\t\t\tinsert into wst.apps (\n\t\t\t\tapp_name,\n\t\t\t\tapp_description,\n\t\t\t\tapp_icon,\n\t\t\t\tapp_carousel,\n\t\t\t\tapp_sort,\n\t\t\t\tapp_banner,\n\t\t\t\tsystem_requirement,\n\t\t\t\trating,\n\t\t\t\tcopyright_notice,\n\t\t\t\tdistributor_id,\n\t\t\t\tmodel_id,\n\t\t\t\tdeleted,\n\t\t\t\tprice_plan_ids,\n\t\t\t\tclass,\n\t\t\t\tcategory_ids,\n\t\t\t\tis_show_on_market,\n\t\t\t\tis_show_tool_tip,\n\t\t\t    catpromo\n\t\t\t) values (\n\t\t\t\t$1,$2, $3,$4, $5,$6, $7,$8, $9,$10, $11,$12, $13,$14, $15,$16, $17, $18\n\t\t\t);\n\t\t","time":17485198,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.161Z","msg":"Prepare","time":16374413,"alreadyPrepared":false,"pid":2725706,"name":"SqlCheckAppUniqueByUpdate","sql":"\n\t\t\tselect id\n\t\t\tfrom wst.apps\n\t\t\twhere class = $1\n\t\t\t  AND distributor_id = $2\n\t\t\t  AND model_id = $3\n\t\t\t  AND deleted = false\n\t\t\t;\n\t\t"}
{"level":"info","time":"2024-10-21T02:24:52.195Z","msg":"Prepare","alreadyPrepared":false,"pid":2725706,"name":"SqlQueryAppsVersionList","sql":"\n\t\t\tselect f.id,\n\t\t\t       f.app_id,\n\t\t\t       f.version_name,\n\t\t\t       f.date_released,\n\t\t\t       f.changelog,\n\t\t\t       f.is_latest,\n\t\t\t       f.is_public,\n\t\t\t       f.is_paid,\n\t\t\t       f.filesize,\n\t\t\t       f.md5,\n\t\t\t       f.url,\n\t\t\t       f.force_uninstall,\n\t\t\t       f.filesize \n\t\t\tfrom wst.app_version f \n\t\t\twhere f.deleted = false \n\t\t\tand f.app_id = $1::int  \n\t\t\tlimit $2 offset $3;\n\t\t","time":33465536}
{"level":"info","time":"2024-10-21T02:24:52.210Z","msg":"Prepare","name":"SqlUpdateSelf","sql":"\n\t\t\tSELECT\n\t\t\t\tf.ID AS apk_id,\n\t\t\t\tf.app_name,\n\t\t\t\tf.app_description,\n\t\t\t\tf.app_icon,\n\t\t\t\tf.app_carousel,\n\t\t\t\tf.app_sort,\n\t\t\t\tf.app_banner,\n\t\t\t\tf.system_requirement,\n\t\t\t\tf.rating,\n\t\t\t\tf.copyright_notice,\n\t\t\t\tC.category_name AS categories_name,\n\t\t\t\tP.plan_name AS price_plans_name,\n\t\t\t\tP.price AS price,\n\t\t\t\tf.deleted,\n\t\t\t\tf.CLASS,\n\t\t\t\tV.version_name AS VERSION,\n\t\t\t\tV.md5,\n\t\t\t\tV.url,\n\t\t\t\tV.filesize,\n\t\t\t\tf.is_show_on_market,\n\t\t\t\tf.is_show_tool_tip,\n\t\t\t\tf.catpromo\n\t\t\tFROM\n\t\t\t\twst.apps f\n\t\t\t\tJOIN wst.categories C ON c.id = ANY(f.category_ids)\n\t\t\t\tJOIN wst.price_plans P ON p.id = ANY(f.price_plan_ids)\n\t\t\t\tJOIN wst.distributor D ON f.distributor_id = D.ID\n\t\t\t\tJOIN wst.model M ON f.model_id = M.ID\n\t\t\t\tJOIN wst.app_version V ON f.ID = V.app_id\n\t\t\tWHERE\n\t\t\t\tf.deleted = FALSE\n\t\t\t\tAND V.is_latest = TRUE\n\t\t\t\tAND V.\"class\" = $1\n\t\t\t\tAND f.distributor_id = $2\n\t\t\t\tAND f.model_id = $3\n\t\t","time":14589915,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.229Z","msg":"Prepare","time":18736635,"alreadyPrepared":false,"pid":2725706,"name":"SqlQueryAllCategories","sql":"\n\t\t\tSELECT \n\t\t\t\tC.ID AS category_ids,\n\t\t\t\tCONCAT(C.category_name, ' - ', d.title, ' - ', M.NAME) AS label \n\t\t\tFROM \n\t\t\t\twst.categories C \n\t\t\t\tLEFT JOIN wst.distributor d ON C.distributor_id = d.ID \n\t\t\t\tLEFT JOIN wst.model M ON C.model_id = M.ID\n\t\t\t\tWhere c.deleted = false\n\t\t\t;\n\t\t"}
{"level":"info","time":"2024-10-21T02:24:52.246Z","msg":"Prepare","name":"SqlGetAppDownloadUrl","sql":"\n\t\t\tSELECT url \n\t\t\tFROM wst.app_version \n\t\t\tWHERE app_id = $1 AND is_latest = TRUE AND deleted = false;\n\t\t","time":16840554,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.266Z","msg":"Prepare","name":"SqlQueryPricePlanList","sql":"\n\t\t\tselect \n\t\t\t\tf.id, \n\t\t\t\tf.plan_name, \n\t\t\t\tf.plan_description, \n\t\t\t\tf.billing_cycle, \n\t\t\t\tf.trial_period, \n\t\t\t\tf.price, \n\t\t\t\tf.distributor_id, \n\t\t\t\tf.model_id, \n\t\t\t\td.title as distributorName, \n\t\t\t\tm.name as modelName \n\t\t\tfrom \n\t\t\t\twst.price_plans f \n\t\t\t\tjoin wst.distributor d on f.distributor_id = d.id \n\t\t\t\tjoin wst.model m on f.model_id = m.id \n\t\t\twhere \n\t\t\t\tf.deleted = false \n\t\t\tlimit $1 offset $2;\n\t\t","time":20792183,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.290Z","msg":"Prepare","name":"SqlUpdateApps","sql":"\n\t\t\tupdate wst.apps \n\t\t\tset app_name = $1,\n\t\t\t    app_description = $2,\n\t\t\t    app_icon = $3,\n\t\t\t    app_carousel = $4,\n\t\t\t    app_sort = $5,\n\t\t\t    app_banner = $6,\n\t\t\t    system_requirement = $7,\n\t\t\t    rating = $8,\n\t\t\t    class = $9,\n\t\t\t    copyright_notice = $10,\n\t\t\t    category_ids = $11,\n\t\t\t    price_plan_ids = $12,\n\t\t\t    is_show_on_market = $13,\n\t\t\t    is_show_tool_tip = $14,\n\t\t\t    distributor_id = $15,\n\t\t\t    model_id = $16,\n\t\t\t    deleted = $17,\n\t\t\t    catpromo =$18\n\t\t\tWHERE id = $19;\n\t\t","time":13906670,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.302Z","msg":"Prepare","name":"SqlCheckAppPrice","sql":"\n\t\t\t\t\t\tSELECT plan_name\n\t\t\t\t FROM wst.price_plans\n  \t\t\t\t WHERE id = ANY($1::int[])\n\t\t\t\t AND distributor_id = $2\n\t\t\t\t AND model_id = $3\n\t\t","time":11547878,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.318Z","msg":"Prepare","name":"SqlDeleteAppUser","sql":"\n\t\t\tDELETE FROM wst.app_user WHERE mac = $1;\n\t\t","time":16352677,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.338Z","msg":"Prepare","alreadyPrepared":false,"pid":2725706,"name":"SqlFindDistributorModelByMacInTerminal","sql":"\n\t\t\t(SELECT is_used FROM rja.terminal WHERE mac_string = $1 )\n\t\t\tUNION ALL\n\t\t\t(SELECT is_used FROM tv_rja.terminal WHERE mac_string = $1);\n\t\t","time":20089899}
{"level":"info","time":"2024-10-21T02:24:52.360Z","msg":"Prepare","pid":2725706,"name":"SqlCountAppsVersionList","sql":"\n\t\t\tselect count(id) as total \n\t\t\tfrom wst.app_version \n\t\t\twhere deleted = false;\n\t\t","time":21063092,"alreadyPrepared":false}
{"level":"info","time":"2024-10-21T02:24:52.393Z","msg":"Prepare","name":"SqlCountCategoriesList","sql":"select count(id) as total from wst.categories f where \n\t\t\t\t\t\t\t  \tCASE WHEN $1 = '' THEN TRUE ELSE f.distributor_id =$1::BIGINT END\n\t\t\t\t\t\t\t\tAND CASE WHEN $2 = '' THEN TRUE ELSE f.model_id =$2::BIGINT END\n\t\t\t\t\t\t\t\tAND f.deleted = FALSE;","time":17603526,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.406Z","msg":"Prepare","name":"SqlUpdateCategories","sql":"update wst.categories set category_name = $1,deleted = $2,distributor_id = $3,model_id = $4,sort = $5 where id = $6;","time":12628281,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.422Z","msg":"Prepare","sql":"\n\t\t\tSELECT\n\t\t\t\tf.ID AS apk_id,\n\t\t\t\tf.app_name,\n\t\t\t\tf.app_description,\n\t\t\t\tf.app_icon,\n\t\t\t\tf.app_carousel,\n\t\t\t\tf.app_sort,\n\t\t\t\tf.app_banner,\n\t\t\t\tf.system_requirement,\n\t\t\t\tf.rating,\n\t\t\t\tf.copyright_notice,\n\t\t\t\tC.category_name AS categories_name,\n\t\t\t\tP.plan_name AS price_plans_name,\n\t\t\t\tP.price AS price,\n\t\t\t\tf.deleted,\n\t\t\t\tf.CLASS,\n\t\t\t\tV.version_name AS VERSION,\n\t\t\t\tV.md5,\n\t\t\t\tV.url,\n\t\t\t\tV.filesize,\n\t\t\t\tf.is_show_on_market,\n\t\t\t\tf.is_show_tool_tip\n\t\t\tFROM\n\t\t\t\twst.apps f\n\t\t\t\tJOIN wst.categories C ON c.id = ANY(f.category_ids)\n\t\t\t\tJOIN wst.price_plans P ON p.id = ANY(f.price_plan_ids) \n\t\t\t\tJOIN wst.distributor D ON f.distributor_id = D.ID\n\t\t\t\tJOIN wst.model M ON f.model_id = M.ID\n\t\t\t\tJOIN wst.app_version V ON f.ID = V.app_id\n\t\t\tWHERE\n\t\t\t\tf.deleted = FALSE\n\t\t\t\tAND V.is_latest = TRUE\n\t\t\t\tAND V.\"class\" = $1\n\t\t\t\tAND f.distributor_id = $2\n\t\t\t\tAND f.model_id = $3\n\t\t","time":16895738,"alreadyPrepared":false,"pid":2725706,"name":"SqlQueryAppsNewestVersion"}
{"level":"info","time":"2024-10-21T02:24:52.434Z","msg":"Prepare","name":"SqlCountAppsList","sql":"\n\t\t\tselect count(id) as total \n\t\t\tfrom wst.apps f\n\t\t\twhere CASE WHEN $1 = '' THEN TRUE ELSE f.distributor_id =$1::BIGINT END\n\t\t\tAND CASE WHEN $2 = '' THEN TRUE ELSE f.model_id =$2::BIGINT END\n\t\t\tAND CASE WHEN $3 = '' THEN TRUE ELSE f.app_name ILIKE '%' ||$3 || '%' END\n    \t\tAND (CASE WHEN $4 = 0 THEN TRUE ELSE $4::BIGINT = ANY(f.category_ids) END)\n\t\t\tAND f.deleted = FALSE\n\t\t","time":11683362,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.479Z","msg":"Prepare","name":"SqlInsertAppByCopy","sql":"\n\t\t\tinsert into wst.apps (\n\t\t\t\tapp_name,\n\t\t\t\tapp_description,\n\t\t\t\tapp_icon,\n\t\t\t\tapp_carousel,\n\t\t\t\tapp_sort,\n\t\t\t\tapp_banner,\n\t\t\t\tsystem_requirement,\n\t\t\t\trating,\n\t\t\t\tcopyright_notice,\n\t\t\t\tdistributor_id,\n\t\t\t\tmodel_id,\n\t\t\t\tdeleted,\n\t\t\t\tprice_plan_ids,\n\t\t\t\tclass,\n\t\t\t\tcategory_ids,\n\t\t\t\tis_show_on_market,\n\t\t\t\tis_show_tool_tip,\n\t\t\t    catpromo\n\t\t\t) values (\n\t\t\t\t$1,$2, $3,$4, $5,$6, $7,$8, $9,$10, $11,$12, $13,$14, $15,$16, $17, $18\n\t\t\t) RETURNING  id;\n\t\t","time":23755609,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.496Z","msg":"Prepare","name":"SqlQueryAppsList","sql":"\n\t\t      \tSELECT\n\t\t\t\t\tf.id,\n\t\t\t\t\tf.app_name,\n\t\t\t\t\tf.app_description :: TEXT,\n\t\t\t\t\tf.app_icon,\n\t\t\t\t\tf.app_sort,\n\t\t\t\t\tf.app_banner,\n\t\t\t\t\tf.app_carousel,\n\t\t\t\t\tf.system_requirement :: TEXT,\n\t\t\t\t\tf.rating,\n\t\t\t\t\tf.copyright_notice :: TEXT,\n\t\t\t\t\tf.category_ids,\n\t\t\t\t\tf.price_plan_ids,\n\t\t\t\t\tf.distributor_id :: TEXT,\n\t\t\t\t\tf.model_id :: TEXT,\n\t\t\t\t\tARRAY_AGG(DISTINCT c.category_name) AS categories_name,\n\t\t\t\t\tARRAY_AGG(DISTINCT p.plan_name) AS price_plans_name,\n\t\t\t\t\tm.name AS model_name,\n\t\t\t\t\td.title AS distributor_name,\n\t\t\t\t\tf.class,\n\t\t\t\t\tf.is_show_on_market,\n\t\t\t\t\tf.is_show_tool_tip,\n\t\t\t\t\tf.catpromo,\n\t\t\t\t\tf.category_id\n\t\t\t\tFROM\n\t\t\t\t\twst.apps f\n\t\t\t\tJOIN\n\t\t\t\t\twst.distributor d ON f.distributor_id = d.id\n\t\t\t\tJOIN\n\t\t\t\t\twst.model m ON f.model_id = m.id\n\t\t\t\tLEFT JOIN\n\t\t\t\t\twst.categories c ON c.id = ANY(f.category_ids)\n\t\t\t\tLEFT JOIN\n\t\t\t\t\twst.price_plans p ON p.id = ANY(f.price_plan_ids)\n\t\t\t\tWHERE\n\t\t\t\t\tCASE WHEN $1 = '' THEN TRUE ELSE f.distributor_id =$1::BIGINT END\n\t\t\t\t\tAND CASE WHEN $2 = '' THEN TRUE ELSE f.model_id =$2::BIGINT END\n\t\t\t\t\tAND CASE WHEN $3 = '' THEN TRUE ELSE f.app_name ILIKE '%' ||$3 || '%' END\n    \t\t\t\tAND (CASE WHEN $4 = 0 THEN TRUE ELSE $4::BIGINT = ANY(f.category_ids) END)\n\t\t\t\t\tAND f.deleted = FALSE\n\t\t\t\tGROUP BY\n\t\t\t\t\tf.id, f.app_name, f.app_description, f.app_icon, f.app_sort, f.app_banner, f.app_carousel,\n\t\t\t\t\tf.system_requirement, f.rating, f.copyright_notice, f.category_ids, f.price_plan_ids,\n\t\t\t\t\tf.distributor_id, f.model_id, m.name, d.title, f.class, f.is_show_on_market, f.is_show_tool_tip\n\t\t\t\t\tLIMIT $5 OFFSET $6;\n\t\t","time":17619695,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.510Z","msg":"Prepare","name":"SqlFindDistributorModelByMacInAccount","sql":"\n\t\t\t(SELECT distributor_id, model_id FROM rja.account WHERE mac_string = $1 AND is_active = true )\n\t\t\tUNION ALL\n\t\t\t(SELECT distributor_id, model_id FROM tv_rja.account WHERE mac_string = $1 AND is_active = true);\n\t\t","time":13705332,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.527Z","msg":"Prepare","name":"SqlInsertCategories","sql":"insert into wst.categories (category_name,distributor_id,model_id,sort) values ($1,$2,$3,$4);","time":13912861,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.538Z","msg":"Prepare","name":"SqlQueryCategoriesList","sql":"\n\t\t\t\t\t\t\t\tSELECT\n\t\t\t\t\t\t\t\t\tf.id,\n\t\t\t\t\t\t\t\t\tf.category_name,\n\t\t\t\t\t\t\t\t\tf.distributor_id,\n\t\t\t\t\t\t\t\t\tf.model_id,\n\t\t\t\t\t\t\t\t\td.title ::text AS distributorName,\n\t\t\t\t\t\t\t\t\tM.NAME ::text AS modelName,\n\t\t\t\t\t\t\t\t\tf.sort\n\t\t\t\t\t\t\t\tFROM\n\t\t\t\t\t\t\t\t\twst.categories f\n\t\t\t\t\t\t\t\t\tJOIN wst.distributor d ON f.distributor_id  = d.id\n\t\t\t\t\t\t\t\t\tJOIN wst.model M ON f.model_id = M.ID \n\t\t\t\t\t\t\t\tWHERE\n\t\t\t\t\t\t\t\tCASE WHEN $1 = '' THEN TRUE ELSE f.distributor_id =$1::BIGINT END\n\t\t\t\t\t\t\t\tAND CASE WHEN $2 = '' THEN TRUE ELSE f.model_id =$2::BIGINT END\n\t\t\t\t\t\t\t\tAND f.deleted = FALSE\n\t\t\t\t\t\t\t\tLIMIT $3 OFFSET $4;","time":11175966,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.551Z","msg":"Prepare","name":"SqlQueryAllPricePlan","sql":"\n\t\t\tSELECT \n\t\t\t\tC.ID AS id, \n\t\t\t\tCONCAT(C.plan_name, ' - ', d.title, ' - ', M.NAME) AS label \n\t\t\tFROM \n\t\t\t\twst.price_plans C \n\t\t\t\tLEFT JOIN wst.distributor d ON C.distributor_id = d.ID \n\t\t\t\tLEFT JOIN wst.model M ON C.model_id = M.ID;\n\t\t","time":12281531,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.562Z","msg":"Prepare","alreadyPrepared":false,"pid":2725706,"name":"SqlUpdateAppUser","sql":"\n\t\t\tupdate wst.app_user \n\t\t\tset user_name = $1, \n\t\t\t    password = $2, \n\t\t\t    ip = $3, \n\t\t\t    country = $4, \n\t\t\t    city = $5, \n\t\t\t    distributor_id = $6, \n\t\t\t    model_id = $7, \n\t\t\t    deleted = $8,\n\t\t\t    is_active = $9,\n\t\t\t    is_service = $10,\n\t\t\t    is_expired = $11\n\t\t\tWHERE mac = $12;\n\t\t","time":11434204}
{"level":"info","time":"2024-10-21T02:24:52.577Z","msg":"Prepare","time":14455626,"alreadyPrepared":false,"pid":2725706,"name":"SqlUpdateAppsVersionIsLatest","sql":"\n\t\t\tUPDATE wst.app_version \n\t\t\tSET is_latest = false \n\t\t\tWHERE app_id = $1;\n\t\t"}
{"level":"info","time":"2024-10-21T02:24:52.589Z","msg":"Prepare","name":"SqlQueryApps","sql":"\n\t\t\tSELECT\n\t\t\t\tf.ID AS apk_id,\n\t\t\t\tf.app_name,\n\t\t\t\tf.app_description,\n\t\t\t\tf.app_icon,\n\t\t\t\tf.app_carousel,\n\t\t\t\tf.app_sort,\n\t\t\t\tf.app_banner,\n\t\t\t\tf.system_requirement,\n\t\t\t\tf.rating,\n\t\t\t\tf.copyright_notice,\n\t\t\t\tC.category_name AS categories_name,\n\t\t\t\tP.plan_name AS price_plans_name,\n\t\t\t\tP.price AS price,\n\t\t\t\tf.deleted,\n\t\t\t\tf.CLASS,\n\t\t\t\tV.version_name AS VERSION,\n\t\t\t\tV.md5,\n\t\t\t\tV.url,\n\t\t\t\tV.filesize,\n\t\t\t\tf.is_show_on_market,\n\t\t\t\tf.is_show_tool_tip,\n\t\t\t\tf.catpromo\n\t\t\tFROM\n\t\t\t\twst.apps f\n\t\t\t\tJOIN wst.categories C ON  c.id = ANY(f.category_ids)\n\t\t\t\tJOIN wst.price_plans P ON p.id = ANY(f.price_plan_ids)\n\t\t\t\tJOIN wst.app_version V ON f.ID = V.app_id\n\t\t\tWHERE\n\t\t\t\tf.deleted = FALSE\n\t\t\t\tAND V.is_latest = TRUE\n\t\t\t\tAND f.app_name ILIKE $1\n\t\t\t\tAND f.distributor_id = $2\n\t\t\t\tAND f.model_id = $3\n\t\t\tORDER BY \n\t\t\t    CAST(app_sort AS INTEGER) ASC;\n\t\t","time":11935139,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.607Z","msg":"Prepare","pid":2725706,"name":"SqlQueryAppUserByMac","sql":"SELECT user_name,password,mac,ip,country,city,distributor_id,model_id,last_login,is_active,is_service,is_expired FROM wst.app_user WHERE mac = $1 AND deleted = false;","time":11678011,"alreadyPrepared":false}
{"level":"info","time":"2024-10-21T02:24:52.618Z","msg":"Prepare","time":10859833,"alreadyPrepared":false,"pid":2725706,"name":"SqlQueryAppUserList","sql":"\n\t\t\tSELECT\n\t\t\t\tf.user_name,\n\t\t\t\tf.PASSWORD,\n\t\t\t\tf.mac,\n\t\t\t\tf.ip,\n\t\t\t\tf.country,\n\t\t\t\tf.city,\n\t\t\t\tf.last_login,\n\t\t\t\tf.OPERATOR,\n\t\t\t\tf.distributor_id,\n\t\t\t\tf.model_id,\n\t\t\t\td.title :: TEXT AS distributorName,\n\t\t\t\tM.NAME :: TEXT AS modelName,\n\t\t\t\tf.is_active,\n\t\t\t    f.is_service,\n\t\t\t    f.is_expired\n\t\t\tFROM\n\t\t\t\twst.app_user f\n\t\t\t\tJOIN wst.distributor d ON f.distributor_id = d.ID\n\t\t\t\tJOIN wst.model M ON f.model_id = M.ID \n\t\t\twhere \n\t\t\t    CASE WHEN $1 = '' THEN TRUE ELSE f.distributor_id =$1::BIGINT END\n\t\t\t\tAND CASE WHEN $2 = '' THEN TRUE ELSE f.model_id =$2::BIGINT END\n\t\t\t\tAND CASE WHEN $3 = '' THEN TRUE ELSE f.mac ILIKE '%' ||$3 || '%' END\n\t\t\t\tAND f.deleted = FALSE\n\t\t\tLIMIT $4 OFFSET $5;\n\t\t"}
{"level":"info","time":"2024-10-21T02:24:52.645Z","msg":"Prepare","pid":2725706,"name":"SqlInsertAppUser","sql":"\n\t\t\tINSERT INTO wst.app_user (\n\t\t\t\tuser_name, \n\t\t\t\tPASSWORD, \n\t\t\t\tmac, \n\t\t\t\tip, \n\t\t\t\tcountry, \n\t\t\t\tcity, \n\t\t\t\tdistributor_id, \n\t\t\t\tmodel_id, \n\t\t\t\tlast_login, \n\t\t\t\toperator, \n\t\t\t\tdeleted,\n\t\t\t\tis_active,\n\t\t\t  \tis_expired,\n\t\t\t    is_service                      \n\t\t\t) VALUES (\n\t\t\t\t$1,$2, $3,$4, $5,$6, $7,$8, $9,$10, $11,$12,$13,$14\n\t\t\t) ON CONFLICT (mac) DO NOTHING\n\t\t\tRETURNING user_name, PASSWORD, mac, ip, country, city, distributor_id, model_id, last_login, operator;\n\t\t","time":26977024,"alreadyPrepared":false}
{"level":"info","time":"2024-10-21T02:24:52.656Z","msg":"Prepare","sql":"\n\t\t\tinsert into wst.app_version (\n\t\t\t\tapp_id,\n\t\t\t\tversion_name,\n\t\t\t\tdate_released,\n\t\t\t\tchangelog,\n\t\t\t\tis_latest,\n\t\t\t\tis_public,\n\t\t\t\tis_paid,\n\t\t\t\tfilesize,\n\t\t\t\tmd5,\n\t\t\t\turl,\n\t\t\t\tforce_uninstall,\n\t\t\t\tdeleted,\n\t\t\t\tclass\n\t\t\t) values (\n\t\t\t\t$1,$2, $3,$4, $5,$6, $7,$8, $9,$10, $11,$12, $13\n\t\t\t);\n\t\t","time":11424967,"alreadyPrepared":false,"pid":2725706,"name":"SqlInsertAppsVersion"}
{"level":"info","time":"2024-10-21T02:24:52.687Z","msg":"Prepare","name":"SqlFindAppsVersion","sql":"\n\t\t\tUPDATE wst.app_version \n\t\t\tSET is_latest = TRUE \n\t\t\tWHERE\n\t\t\tdate_released = ( SELECT MAX(date_released) FROM wst.app_version WHERE app_id = $1 AND is_latest = FALSE) \n\t\t\tAND app_id = $1;\n\t\t","time":11562715,"alreadyPrepared":false,"pid":2725706}
{"level":"info","time":"2024-10-21T02:24:52.698Z","msg":"Prepare","pid":2725706,"name":"SqlUpdateAppsVersion","sql":"\n\t\t\tupdate wst.app_version \n\t\t\tset version_name = $1,\n\t\t\tchangelog = $2,\n\t\t\tis_latest = $3,\n\t\t\tis_paid = $4,\n\t\t\tfilesize = $5,\n\t\t\tmd5 = $6,\n\t\t\turl = $7,\n\t\t\tforce_uninstall = $8,\n\t\t\tdeleted = $9,\n\t\t\tis_public = $10\n\t\t\twhere id = $11;\n\t\t","time":11116101,"alreadyPrepared":false}
{"level":"info","time":"2024-10-21T02:24:52.720Z","msg":"Prepare","time":22306826,"alreadyPrepared":false,"pid":2725706,"name":"SqlUpdatePricePlan","sql":"\n\t\t\tupdate wst.price_plans \n\t\t\tset plan_name = $1, \n\t\t\t    plan_description = $2, \n\t\t\t    billing_cycle = $3, \n\t\t\t    trial_period = $4, \n\t\t\t    price = $5, \n\t\t\t    distributor_id = $6, \n\t\t\t    model_id = $7, \n\t\t\t    deleted = $8 \n\t\t\twhere id = $9;\n\t\t"}
